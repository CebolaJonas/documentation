{{ $text := .Get "text" }}
{{ $tooltip := .Get "tooltip" }}
{{ $glossary := .Get "glossary" }}
{{ $displayText := $text }}
{{ $tooltipContent := $tooltip }}

{{ if $glossary }}
  {{ $glossaryTerm := replace $glossary " " "_" }}
  {{ $headless := .Site.GetPage "/glossary/terms" }}
  {{ with $headless.Resources.GetMatch (printf "%s.md" $glossaryTerm) }}
    {{ $displayText = $glossary }}
    {{ if .Params.short_definition }}
      {{ $tooltipContent = .Params.short_definition }}
    {{ else }}
      {{ $content := .Content | plainify }}
      {{ $tooltipContent = $content | replaceRE `\n\[\d+\]:\s+.*` "" | replaceRE `\[([^\]]+)\]\[\d+\]` "$1" | safeHTML }}
    {{ end }}
  {{ else }}
    {{ warnf "Glossary term '%s' not found" $glossary }}
    {{ $tooltipContent = printf "Glossary term '%s' not found" $glossary }}
  {{ end }}
{{ end }}

<span class="tooltip-container" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
  <span class="tooltip-trigger">{{ $displayText }}</span>
  <span id="tooltip-{{ $displayText | urlize }}" class="tooltip-content" x-bind:class="{ 'show': open }" role="tooltip">
    {{ $tooltipContent }}
    <svg class="tooltip-arrow" width="14" height="7" viewBox="0 0 14 7">
      <path d="M7 7L0 0h14z" fill="currentColor"></path>
    </svg>
  </span>
</span>